(self.webpackChunkarches=self.webpackChunkarches||[]).push([[238,3600],{70238:function(n,i,e){Promise.all([e.e(3556),e.e(3412),e.e(5838),e.e(1259),e.e(5112),e.e(616),e.e(2171),e.e(5453),e.e(566),e.e(3512)]).then((function(){var n=[e(20198),e(84490),e(54922),e(46186),e(63784),e(20346),e(81878),e(68928),e(28273),e(82506),e(60662),e(72151),e(10001),e(25040)];(function(n,i,e,t,c,o,u,s,r,a,d,l){var f=[],p=e.observableArray(i.map(l.applied_functions,(function(n){return n.function_id}))),F={loading:e.observable(!1),selectedFunction:e.observable()};l.functions.forEach((function(n){f.push(new r(n))}),this),F.functionList=new u({functions:e.observableArray(f)}),F.functionList.on("item-clicked",(function(n){var i=new a({id:null,graphid:d.graphid,function:n,function_id:n.functionid,config:n.defaultconfig});F.appliedFunctionList.items.push(i),F.appliedFunctionList.selectItem(i)})),F.appliedFunctionList=new s({functions:e.observableArray()}),l.applied_functions.forEach((function(n){n.function=i.find(f,(function(i){return i.functionid===n.function_id})),F.appliedFunctionList.items.push(new a(n))}),this),F.appliedFunctionList.on("item-clicked",(function(n){n.selected()?F.selectedFunction(n):F.selectedFunction(void 0)})),F.toggleFunctionLibrary=function(){F.selectedFunction()?(F._selectedFunction=F.selectedFunction(),F._selectedFunction.selected(!1),F.selectedFunction(void 0)):(F.selectedFunction(F._selectedFunction),F._selectedFunction.selected(!0))},F.dirty=e.computed((function(){return!(!F.selectedFunction()||!1!==i.contains(p(),F.selectedFunction().function_id))||!!i.find(F.appliedFunctionList.items(),(function(n){return n.dirty()}))}));var alertFailure=function(n){h.viewModel.alert(new o("ep-alert-red",n))};F.save=function(){var e=[];F.loading(!0),F.appliedFunctionList.items().forEach((function(n){!n.dirty()&&n.function.component()||e.push(n.toJSON())})),n.ajax({type:"POST",url:t.urls.apply_functions.replace("//","/"+d.graphid+"/"),data:JSON.stringify(e),success:function(n){n.forEach((function(n){p.push(n.function_id),i.find(F.appliedFunctionList.items(),(function(i){return n._id===i.toJSON()._id})).parse(n)})),F.loading(!1)},error:function(n){F.loading(!1),alertFailure(n.responseJSON)}})},F.delete=function(i){i.id?n.ajax({type:"DELETE",url:t.urls.remove_functions.replace("//","/"+d.graphid+"/"),data:JSON.stringify([i]),success:function(){p.remove(i.function_id),F.appliedFunctionList.items.remove(i),F.toggleFunctionLibrary(),F.loading(!1)},error:function(n){F.loading(!1),alertFailure(n.responseJSON)}}):(F.appliedFunctionList.items.remove(i),F.toggleFunctionLibrary())},F.cancel=function(){F.appliedFunctionList.items().forEach((function(n){n.dirty()&&n.reset(),n.id||(F.appliedFunctionList.items.remove(n),F.selectedFunction()===n&&F.toggleFunctionLibrary())}))},F.filterFunctions=function(){var n=this;return function(e){var t=i.pluck(e,"function_id");i.each(n.functionList.items(),(function(n){i.contains(t,n.functionid)?n.filtered(!0):!0===n.filtered()&&n.filtered(!1)}),this)}},F.appliedFunctionList.items.subscribe(F.filterFunctions()),F.appliedFunctionList.items.valueHasMutated();var h=new c({viewModel:F})}).apply(null,n)})).catch(e.oe)}}]);