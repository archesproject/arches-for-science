{% load i18n %}
<div class="file-configuration" style="width: 100%;height: calc(100% - 105px);display:flex;">
    <div class="uploaded-files" style="width: 32.6793%;padding: 10px;padding-top: 0;">
        <h4><span>{% trans "Uploaded Files" %}</span></h4>
        <span>{% trans "Specify how to process the data files for viewing.  Any additional files (such as images) will be automatically displayed if possible." %}</span>
        <div class="file-button-container">
            <div class="file-buttons" data-bind="click:() => {fileMode('data')}" role="button">{% trans "Data Files" %}</div>
            <div style="margin: 0 5px"></div>
            <div class="file-buttons" data-bind="click:() => {fileMode('other')}" role="button">{% trans "Additional Files" %}</div>
        </div>

        <div class="pad-btm" data-bind="visible: currentFiles().length > 0" style="overflow-y: scroll;padding: 7px; max-height: calc(100% - 100px);">
            <table class="table table-striped" cellspacing="0" width="100%">
                <thead>
                    <tr class="afs-table-header">
                        <th class="min-tabletl">{% trans "Name" %}</th>
                        <th class="min-tabletl">{% trans "Configuration" %}</th>
                        <th style="width:40px;" class="afs-table-control all"></th>
                    </tr>
                </thead>
                <tbody data-bind="dataTablesForEach: { data: currentFiles, as: 'file', dataTableOptions: fileTableConfig }">
                    <tr>
                        <td>
                            <div style="display: flex; align-items:center;">
                                <input style="margin: 10px" type="checkbox" data-bind="value: file.fileid, checked: $parent.selectedFiles">
                                <div style="padding:8px;min-height: 39px;align-items:center;display:flex;cursor:pointer;width:100%" data-bind="click: function() { $parent.displayFile(file) },text: file.details.name"></div>
                            </div>
                        </td>
                        <td style="padding:8px;cursor:pointer" data-bind="click: function() { $parent.displayFile(file) }">
                            <div>
                                <input style="display:inline-block; flex: 1"
                                    data-bind="
                                    value: file.details.rendererConfig,
                                    select2Query: {
                                        select2Config: {
                                            clickBubble: false,
                                            disabled: file.details.disabledConfig,
                                            width: 'element',
                                            ajax:{
                                                url: $parent.rendererUrl,
                                                results: $parent.processConfigs
                                            },
                                            initSelection: $parent.initSelection,
                                            value: file.details.rendererConfig,
                                            closeOnSelect: true,
                                            allowClear: false,
                                            multiple: false 
                                        }
                                    }">
                            </div>
                        </td>
                        <td style="padding:8px;cursor:pointer" data-bind="click: function() { $parent.displayFile(file) }">
                            <div style="display: flex;min-width: 34px;">
                                <i style="flex:1"></i>
                                <i data-bind="visible: $parent.visibleFile() == file.fileid" role="button" aria-label="{% trans "Selected File" %}" class="fa fa-eye"></i>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div style="cursor:col-resize; width:18px;" class="resizer"></div>
    <div class="active-files" style="width: 31.9659%; display: flex; flex-direction: column">
        <div data-bind="visible: !(selectedFiles().length > 1)">
            <h4 data-bind="text: selectedFile()?.details?.name"></h4>
            <div class="cm" style="border: 1px solid #ddd" >
                <div data-bind="codemirror: {
                    value: codeMirrorText,
                    mode: { name: 'javascript', json: true, readOnly: true },
                    lineNumbers: true,
                    lineWrapping: true
                }"></div>
            </div>
        </div>
        <div data-bind="visible: parsedData() && !(selectedFiles().length > 1)">
            <h4>{% trans "Import Preview" %}</h4>
            <div style="display: flex;flex-direction: column; flex: 1" class="parsing-preview">
                <div class="cm" style="border: 1px solid #ddd" >
                    <div data-bind="codemirror: {
                        value: parsedData,
                        mode: { name: 'text', json: true, readOnly: true },
                        lineNumbers: true,
                        lineWrapping: true
                    }"></div>
                </div>
            </div>
        </div>
        <div data-bind="visible: (selectedFiles().length > 1)">
            <h4>{% trans "Selected Files" %}</h4>
            <div class="selected-files" data-bind="foreach: {data: selectedFiles(), as: 'file'}">
                <div data-bind="text: $parent.fileMap()[file]?.details?.name"></div>
            </div>
            <span data-bind="visible: !applyConfigurationVisible()">{% trans "Select an importer configuration on the right to apply to all files" %}</span>
            <button class="btn btn-primary" data-bind="visible: applyConfigurationVisible(), click:()=>{applyConfigurationVisible(false), selectedFiles([])}">{% trans "Apply Importer to Selected Files" %}</button>
        </div>
    </div>
    <div style="cursor:col-resize;width:18px;" class="resizer"></div>
    <div style="width: 32.3226%;padding: 10px; padding-top: 0;">
        {% block importerConfiguration %}
        <!-- ko component: {
            name: 'importer-configuration',
            params: {
                selectedConfiguration: selectedConfiguration,
                rendererConfigs: rendererConfigs
            }
        } --> 
        <!-- /ko -->
        {% endblock importerConfiguration %}
    </div>
</div>